<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Borrione Racing - Versión Final</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #222; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; margin: 0 auto; image-rendering: pixelated; }
        #ui { position: absolute; top: 15px; left: 15px; color: #fff; font-size: 18px; text-shadow: 2px 2px #000; pointer-events: none; z-index: 10; }
    </style>
</head>
<body>

<div id="ui">
    SCORE: <span id="score">0</span><br>
    NEAR MISS: <span id="nearMiss">0</span>
</div>
<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    const nearMissElement = document.getElementById('nearMiss');

    // --- CONFIGURACIÓN Y ASSETS ---
    let score = 0;
    let nearMissCount = 0;
    let gameSpeed = 6;
    let imagesLoaded = 0;

    const assets = {
        player: new Image(),
        npc: new Image(),
        fondo: new Image()
    };

    // NOMBRES EXACTOS DE TUS ARCHIVOS EN GITHUB
    assets.player.src = 'auto_inicial.png'; 
    assets.npc.src = 'npc_rojo.png'; 
    assets.fondo.src = 'pasto.jpg'; 

    const checkLoad = () => { imagesLoaded++; };
    assets.player.onload = checkLoad;
    assets.npc.onload = checkLoad;
    assets.fondo.onload = checkLoad;

    // --- AJUSTE DE PANTALLA ---
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- OBJETOS ---
    const player = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 130,
        w: 50,
        h: 90
    };

    let obstacles = [];
    let touchX = player.x;

    // Control Táctil suave
    window.addEventListener('touchmove', (e) => {
        touchX = e.touches[0].clientX - player.w / 2;
        e.preventDefault();
    }, {passive: false});

    function spawnNPC() {
        const laneWidth = (canvas.width - 80) / 3;
        const x = 40 + Math.floor(Math.random() * 3) * laneWidth;
        obstacles.push({ x: x, y: -100, w: 50, h: 90, passed: false });
    }

    // --- LÓGICA ---
    function update() {
        // Movimiento suave del auto
        player.x += (touchX - player.x) * 0.15;

        // Limites de la carretera
        if(player.x < 40) player.x = 40;
        if(player.x > canvas.width - player.w - 40) player.x = canvas.width - player.w - 40;

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.y += gameSpeed;

            // DETECCIÓN DE NEAR MISS (Pasar muy cerca sin chocar)
            let diffX = Math.abs((player.x + player.w/2) - (o.x + o.w/2));
            let diffY = Math.abs((player.y + player.h/2) - (o.y + o.h/2));

            if (!o.passed && diffY < 60 && diffX < 75 && diffX > 48) {
                nearMissCount++;
                nearMissElement.innerText = nearMissCount;
                o.passed = true;
            }

            // COLISIÓN
            if (player.x < o.x + o.w && player.x + player.w > o.x &&
                player.y < o.y + o.h && player.y + player.h > o.y) {
                // Reset al chocar
                score = 0;
                nearMissCount = 0;
                obstacles = [];
                gameSpeed = 6;
                scoreElement.innerText = "0";
                nearMissElement.innerText = "0";
            }

            if (o.y > canvas.height) {
                obstacles.splice(i, 1);
                score += 10;
                scoreElement.innerText = score;
                if(score % 200 === 0) gameSpeed += 0.5;
            }
        }

        if (Math.random() < 0.02) spawnNPC();
    }

    // --- DIBUJO ---
    let backgroundY = 0;
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Dibujar Pasto (Fondo infinito)
        if (imagesLoaded >= 3) {
            backgroundY += gameSpeed;
            if (backgroundY >= canvas.height) backgroundY = 0;
            ctx.drawImage(assets.fondo, 0, backgroundY - canvas.height, canvas.width, canvas.height);
            ctx.drawImage(assets.fondo, 0, backgroundY, canvas.width, canvas.height);
        }

        // 2. Dibujar Carretera
        ctx.fillStyle = "#333";
        ctx.fillRect(30, 0, canvas.width - 60, canvas.height);
        
        // Líneas blancas
        ctx.strokeStyle = "#fff";
        ctx.setLineDash([30, 30]);
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(canvas.width/2, 0);
        ctx.lineTo(canvas.width/2, canvas.height);
        ctx.stroke();

        // 3. Dibujar Autos con los nombres de tus archivos
        if (imagesLoaded >= 3) {
            // Jugador (auto_inicial.png)
            ctx.drawImage(assets.player, player.x, player.y, player.w, player.h);
            
            // Enemigos (npc_rojo.png)
            obstacles.forEach(o => {
                ctx.drawImage(assets.npc, o.x, o.y, o.w, o.h);
            });
        }
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
</body>
</html>


